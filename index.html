<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="pushsdk" content="673493dd66ab3a71f11d11640c66b029">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Platyearn</title>
  <link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
  crossorigin="anonymous"
  />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <script>
      var Back_Button_Zone = 8892973;
      var Domain_TB = "paushaunoosh.net";
</script>
<script async src="https://desenteir.com/96d/c959e/reverse.min.js?sf=1"></script>


  <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
  <script>
    window.TelegramAdsController = new TelegramAdsController();
    window.TelegramAdsController.initialize({
      pubId: "957842",
      appId: "1337",
    });
  </script>
</head>
<body>
</script>
<div class="loading-spinner" id="loading-spinner">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>
<nav
  class="d-flex align-items-center justify-content-between p-2 bg-primary text-light"
  >
  <div class="d-flex align-items-center">
    <img
    src="https://placehold.co/50"
    height="50"
    width="50"
    alt="Profile Picture"
    class="rounded-circle me-2 profile-pic"
    />
    <div>
      <h3 class="mb-0 UserName" style="font-size: 1.25rem">UserName</h3>
      <p class="mb-0 user-balance" style="font-size: 1rem; font-weight: bold">
        $ 0
      </p>
    </div>
  </div>
</nav>
<main class="pb-5">
  <div id="alert-container" class="mt-4"></div>
  <section
    class="dnone profile-section container p-4 bg-light rounded shadow-sm my-4"
    id="profile"
    >
    <h2 class="text-primary mb-4">User Profile</h2>

    <div class="row">
      <!-- Profile Picture and User Info -->
      <div class="col-md-4 text-center mb-4">
        <img
        src="https://placehold.co/150"
        alt="User Logo"
        class="rounded-circle mb-3 profile-pic"
        style="width: 150px; height: 150px"
        />
        <h3 class="text-primary UserName">UserName</h3>
        <p class="text-secondary">
          <strong>Username:</strong> <p class="UserUsername">
            UserUsername
          </p>
        </p>
        <p class="text-secondary">
          <strong>Balance:</strong> <p class="user-balance">
            user-balance
          </p>
        </p>
      </div>

      <!-- Earnings and Stats -->
      <div class="col-md-8">
        <div class="row">
          <!-- Total Earnings -->
          <div class="col-md-6 mb-4">
            <div class="card border-success">
              <div class="card-body">
                <h5 class="card-title text-success">Total Earnings</h5>
                <p class="card-text">
                  <span id="totalEarnings" class="lifetime_earning">lifetime_earning</span>
                </p>
              </div>
            </div>
          </div>


          <!-- Total Ads Watched -->
          <div class="col-md-6 mb-4">
            <div class="card border-info">
              <div class="card-body">
                <h5 class="card-title text-info">Total Ads Watched</h5>
                <p class="card-text">
                  <strong>Ads:</strong> <span id="totalAdsWatched" class="totalAdsWatched">totalAdsWatched</span>
                </p>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </section>

  <section
    class="withdraw-section container p-4 pb-5 mb-5 bg-light rounded shadow-sm"
    id="withdraw"
    style="min-height: 100vh"
    >
    <!-- Withdraw Section Heading -->
    <h2 class="text-primary mb-4">Withdraw</h2>

    <!-- Balance Display -->
    <div class="text-center mb-4">
      <h3 class="text-secondary">
        <strong>Available Balance:</strong> <p class="user-balance">
          user-balance
        </p>
      </h3>
    </div>


    <!-- Include Bootstrap CSS and JS from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Withdraw Form -->
    <div class="card border-info mb-4">
      <div class="card-body">
        <h5 class="card-title text-info">Request Withdrawal</h5>
        <form id="withdraw-form">
          <div class="form-group mb-3">
            <label for="payment-method" class="form-label">Withdrawal Method</label>
            <select class="form-control" id="payment-method" required>
              <option value="">Select a method</option>
              <option value="1">DANA</option>
              <option value="2">OVO</option>
              <option value="3">GOPAY</option>
            </select>
          </div>
          <div class="form-group mb-3">
            <label for="withdraw-amount" class="form-label">Amount</label>
            <input
            type="number"
            class="form-control"
            id="withdraw-amount"
            placeholder="Enter amount"
            min="50"
            required
            />
          </div>
          <div class="form-group mb-3">
            <label for="withdraw-address" class="form-label">Withdrawal Address</label>
            <input
            type="text"
            class="form-control"
            id="withdraw-address"
            placeholder="Enter wallet address"
            required
            />
          </div>
          <button
            type="button"
            id="withdraw-button"
            class="btn btn-primary w-100"
            onClick="handleWithdraw()"
            >
            Submit Withdrawal
          </button>
        </form>
      </div>
    </div>

  </section>

  <section
    class="d-none home-section container p-4 bg-light rounded shadow-sm"
    id="home"
    style="height: 1000px"
    >
    <!-- User Info -->
    <div class="text-center mb-4">
      <img
      src="https://placehold.co/100"
      alt="User Logo"
      class="rounded-circle mb-2 profile-pic"
      style="width: 100px; height: 100px"
      />
      <h3 class="text-primary UserName">UserName</h3>
      <p class="text-secondary">
        <strong>Balance:</strong> <p class="user-balance">
          $100
        </p>
      </p>
    </div>

    <!-- Earnings Report -->
    <div class="earn-section">
      <div class="row">
        <div class="col-md-6 mb-4">
          <!-- Today's Tasks & Progress -->
          <div class="card border-primary">
            <div class="card-body">
              <h5 class="card-title text-primary">Today's Tasks</h5>
              <p class="card-text mb-1">
                <strong>Total Tasks:</strong> <span id="taskCount" class="taskCount">taskCount</span>
              </p>
              <p class="card-text mb-1">
                <strong>Completed:</strong>
                <span id="tasksCompleted" class="tasksCompleted">tasksCompleted</span>
              </p>
              <p class="card-text mb-1">
                <strong>Remaining:</strong>
                <span id="tasksRemaining" class="tasksRemaining">tasksRemaining</span>
              </p>
              <div class="progress mt-3">
                <div
                  class="progress-bar bg-success"
                  role="progressbar"
                  style="width: 60%"
                  aria-valuenow="60"
                  aria-valuemin="0"
                  aria-valuemax="100"
                  >
                  0% Completed
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Earnings Info -->
        <div class="col-md-6 mb-4">
          <div class="card border-success">
            <div class="card-body">
              <h5 class="card-title text-success">Earnings</h5>
              <p class="card-text mb-1">
                <strong>Today's Earnings:</strong>
                <span id="todayEarnings" class="today_earning">today_earning</span>
              </p>
              <p class="card-text mb-1">
                <strong>Lifetime Earnings:</strong>
                <span id="lifetimeEarnings" class="lifetime_earning">lifetime_earning</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section
    class="d-none earn-section container p-4 bg-light rounded shadow-sm"
    id="earn"
    style="height: 100vh"
    >
    <h2 class="text-primary mb-4">Earn</h2>

    <div class="row">
      <!-- Task Count and Progress -->
      <div class="col-md-6 mb-4">
        <div class="card border-primary">
          <div class="card-body">
            <h5 class="card-title text-primary">Today's Tasks</h5>
            <p class="card-text mb-1">
              <strong>Total Tasks:</strong> <span class="ads-limit-value taskCount" id="taskCount">taskCount</span>
            </p>
            <p class="card-text mb-1">
              <strong>Completed:</strong>
              <span id="tasksCompleted" class="tasksCompleted">tasksCompleted</span>
            </p>
            <p class="card-text mb-1">
              <strong>Remaining:</strong>
              <span id="tasksRemaining" class="tasksRemaining">tasksRemaining</span>
            </p>
            <!-- Start Task Button -->
            <button id="show-ad" class="btn btn-primary mt-3 w-100">
              Start Task Monetag
            </button>
            <!--<button id="ad" class="btn btn-primary mt-3 w-100">-->
            <!--  Start Task Adsgram-->
            <!--</button>-->
          </div>
        </div>
      </div>

    </div>
  </section>
</main>

<footer
  class="footer-nav bg-white text-light d-flex justify-content-around align-items-center p-2 fixed-bottom shadow-lg"
  >
  <a
    href="#"
    onclick="showSection('home')"
    class="nav-item text-center text-decoration-none text-primary"
    >
    <img
    src="https://th.bing.com/th/id/R.d4c78c018744a53d7b9bf502ef939e40?rik=5vvMhUTq0TgSEg&pid=ImgRaw&r=0"
    alt="Home Icon"
    class="nav-icon mb-1"
    />
    <p class="mb-0" style="font-size: 0.9rem">
      Home
    </p>
  </a>
  <a
    href="#"
    onclick="showSection('earn')"
    class="nav-item text-center text-decoration-none text-primary"
    >
    <img
    src="https://cdn1.iconfinder.com/data/icons/business-charts/512/salary-512.png"
    alt="Earn Icon"
    class="nav-icon mb-1"
    />
    <p class="mb-0" style="font-size: 0.9rem">
      Earn
    </p>
  </a>
  <a
    href="#"
    onclick="showSection('withdraw')"
    class="nav-item text-center text-decoration-none text-primary"
    >
    <img
    src="https://icons.veryicon.com/png/o/business/work-circle/withdraw-5.png"
    alt="Withdraw Icon"
    class="nav-icon mb-1"
    />
    <p class="mb-0" style="font-size: 0.9rem">
      Withdraw
    </p>
  </a>
  <a
    href="#"
    onclick="showSection('profile')"
    class="nav-item text-center text-decoration-none text-primary"
    >
    <img
    src="https://th.bing.com/th/id/R.19fa7497013a87bd77f7adb96beaf768?rik=144XvMigWWj2bw&riu=http%3a%2f%2fwww.pngall.com%2fwp-content%2fuploads%2f5%2fUser-Profile-PNG-High-Quality-Image.png&ehk=%2bat%2brmqQuJrWL609bAlrUPYgzj%2b%2f7L1ErXRTN6ZyxR0%3d&risl=&pid=ImgRaw&r=0"
    alt="Profile Icon"
    class="nav-icon mb-1"
    />
    <p class="mb-0" style="font-size: 0.9rem">
      Profile
    </p>
  </a>
</footer>
<style>
  .footer-nav {
    border-top: 2px solid rgba(255, 255, 255, 0.1);
  }

  .nav-icon {
    width: 24px;
    height: 24px;
  }

  .nav-item {
    flex-grow: 1;
    padding: 5px;
  }
</style>
<script>
  function showSection(sectionId) {
    const sections = document.querySelectorAll("main > section");

    sections.forEach((section) => {
      if (section.id === sectionId) {
        section.classList.remove("d-none");
      } else {
        section.classList.add("d-none");
      }
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    showSection("home");
  });

  document.addEventListener("DOMContentLoaded", function () {
    const showAdButton = document.getElementById("show-ad");
    const botToken = '7971014111:AAF23urpxpxjcphCJI6AM4KYWGN6lMsJ5Dc'; // Ganti dengan token bot Telegram Anda
    const adminChatId = '5308426585'; // Ganti dengan chat ID admin

    function toggleLoading(show) {
      document.getElementById("loading-spinner").style.display = show ? "flex": "none";
    }

    function showAlert(message, type = "danger") {
      const alertContainer = document.getElementById("alert-container");
      alertContainer.innerHTML = `
      <div class="alert alert-${type} alert-dismissible fade show" role="alert">
      ${message}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      `;
    }

    function fetchUserData(userData) {
      toggleLoading(true);
      const user = JSON.parse(localStorage.getItem(userData.id)) || {
        balance: 0,
        today_ads: 0,
        ads_limit: 10,
        today_earning: 0,
        totalAdsWatched: 0,
        lifetime_earning: 0,
        ...userData
      };
      localStorage.setItem(userData.id, JSON.stringify(user));
      toggleLoading(false);
      updateUI({
        user, success: true
      });
    }

    function handleAdReward(userId) {
      return new Promise((resolve, reject) => {
        toggleLoading(true);
        try {
          const user = JSON.parse(localStorage.getItem(userId));
          if (!user) {
            throw new Error("User not found");
          }

          // Update user balance
          user.balance += 10;
          user.today_ads += 1;
          user.today_earning += 10;
          user.totalAdsWatched += 1;
          user.lifetime_earning += 10;

          localStorage.setItem(userId, JSON.stringify(user));
          updateUI({
            user, success: true
          });
          showAlert("Reward credited successfully!", "success");
          resolve();
        } catch (error) {
          showAlert("There was an error processing your reward.");
          reject(error);
        } finally {
          toggleLoading(false);
        }
      });
    }

    function updateUI(data) {
      if (data.user) {
        const user = data.user;

        updateTextContent(".UserUsername", '@' + user.username || "User");
        updateTextContent(".UserName", user.first_name + ' ' + user.last_name || "User");
        updateTextContent(".user-balance", `BDT ${user.balance || "0.00"}`);
        updateTextContent(".tasksCompleted", user.today_ads || "0");
        updateTextContent(".taskCount", user.ads_limit || "0");
        updateTextContent(".today_earning", `BDT ${user.today_earning || "0.00"}`);
        updateTextContent(".totalAdsWatched", user.totalAdsWatched || "0");
        updateTextContent(".lifetime_earning", `BDT ${user.lifetime_earning || "0.00"}`);
        updateTextContent(".tasksRemaining", user.ads_limit - user.today_ads || "0.00");

        const adsLimit = user.ads_limit || 0;
        const todayAds = user.today_ads || 0;
        const completionPercentage = Math.min((todayAds / adsLimit) * 100, 100);

        const progressBar = document.querySelector(".progress-bar");
        if (progressBar) {
          progressBar.style.width = `${completionPercentage}%`;
          progressBar.setAttribute("aria-valuenow", completionPercentage.toFixed(0));
          progressBar.innerText = `${completionPercentage.toFixed(0)}%`;
        }

        const showAdButton = document.getElementById("show-ad");
        if (showAdButton) {
          if (user.ads_limit - user.today_ads > 0) {
            showAdButton.classList.remove("d-none");
          } else {
            showAdButton.classList.add("d-none");
          }
        }

        const profilePictureUrl = user.photo_url || "https://img.freepik.com/free-vector/blue-circle-with-white-user_78370-4707.jpg";
        document.querySelectorAll(".profile-pic").forEach((img) => {
          img.src = profilePictureUrl;
        });
      } else {
        showAlert("Failed to load user data.");
      }
    }

    function updateTextContent(selector, text) {
      document.querySelectorAll(selector).forEach((el) => {
        el.innerText = text;
      });
    }

    let currentUserId;

    if (window.Telegram.WebApp) {
      const user = Telegram.WebApp.initDataUnsafe.user;
      if (user) {
        const userData = {
          first_name: user.first_name,
          last_name: user.last_name,
          username: user.username,
          language_code: user.language_code,
          photo_url: user.photo_url || "https://img.freepik.com/free-vector/blue-circle-with-white-user_78370-4707.jpg",
          is_premium: user.is_premium,
          id: user.id
        };
        currentUserId = user.id;
        fetchUserData(userData);

        document.querySelectorAll(".profile-pic").forEach((img) => {
          img.src = userData.photo_url;
        });
      }
    }

    if (showAdButton) {
      showAdButton.addEventListener("click", function () {
        showAdButton.disabled = true;

        // Asumsikan show_8860323() adalah fungsi yang mengembalikan Promise
        show_8860323()
        .then(() => {
          if (!currentUserId) {
            throw new Error("User ID not available");
          }
          return handleAdReward(currentUserId);
        })
        .catch(error => {
          console.error("Error:", error);
          showAlert(error.message || "An error occurred");
        })
        .finally(() => {
          showAdButton.disabled = false;
        });
      });
    }

    document.getElementById('withdraw-button').addEventListener('click', handleWithdraw);

    function handleWithdraw() {
      const amount = parseFloat(document.getElementById('withdraw-amount').value);
      const paymentMethodId = document.getElementById('payment-method').value;
      const withdrawAddress = document.getElementById('withdraw-address').value;

      if (!currentUserId || !amount || !paymentMethodId || !withdrawAddress) {
        return showAlert("Please fill in all fields correctly.");
      }

      if (amount < 50) {
        return showAlert("Minimum withdrawal amount is 50 BDT", "danger");
      }

      toggleLoading(true);

      try {
        const user = JSON.parse(localStorage.getItem(currentUserId));
        if (!user) throw new Error("User not found");
        if (user.balance < amount) throw new Error("Insufficient balance");

        // Update balance
        user.balance -= amount;
        localStorage.setItem(currentUserId, JSON.stringify(user));

        // Kirim notifikasi ke admin
        const message = `🚀 New Withdrawal Request!\n\nUser: ${user.first_name} ${user.last_name}\nAmount: ${amount} BDT\nMethod: ${paymentMethodId}\nAddress: ${withdrawAddress}`;

        fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            chat_id: adminChatId,
            text: message,
            parse_mode: 'HTML'
          })
        })
        .then(response => response.json())
        .then(data => {
          if (!data.ok) throw new Error('Failed to send notification');

          updateUI({
            user, success: true
          });
          showAlert("Withdrawal request successful! Admin will process it soon.", "success");
        })
        .catch(error => {
          console.error('Notification error:', error);
          showAlert("Withdrawal processed but failed to notify admin.", "warning");
        });

      } catch (error) {
        showAlert(error.message,
          "danger");
      } finally {
        toggleLoading(false);
      }
    }

  });
</script>

</body>
        </html>
